<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»å…¸æ–—å…½æ£‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { touch-action: manipulation; user-select: none; }
        /* æ£‹ç›˜æ ¼å­å¸ƒå±€ */
        .board-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 2px;
            background-color: #5D4037; /* è¾¹æ¡†è‰² */
            border: 4px solid #5D4037;
            width: 100%;
            max-width: 450px;
            aspect-ratio: 7/9;
        }
        .cell {
            background-color: #DEB887; /* åœŸåœ°é¢œè‰² */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            position: relative;
            cursor: pointer;
        }
        /* åœ°å½¢æ ·å¼ */
        .river { background-color: #4FC3F7; }
        .trap { background-color: #D7CCC8; border: 1px dashed #8D6E63; }
        .den { background-color: #FFECB3; font-weight: bold; font-size: 0.8rem; color: #5D4037; }
        
        /* æ£‹å­æ ·å¼ */
        .piece {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 10;
            transition: transform 0.2s;
        }
        .piece.red { background: linear-gradient(135deg, #FFEBEE, #FFCDD2); border: 2px solid #D32F2F; color: #B71C1C; }
        .piece.blue { background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border: 2px solid #1976D2; color: #0D47A1; }
        
        .selected { transform: scale(1.15); box-shadow: 0 0 15px yellow; z-index: 20; }
        .valid-move::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: rgba(0, 255, 0, 0.6);
            border-radius: 50%;
            z-index: 5;
        }
        .last-move { background-color: rgba(255, 255, 0, 0.3) !important; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="flex flex-col items-center w-full max-w-lg gap-4">
        
        <!-- å¤´éƒ¨ä¿¡æ¯ -->
        <div class="flex justify-between w-full items-center bg-white p-3 rounded-xl shadow-sm">
            <div class="flex items-center gap-2">
                <span class="w-4 h-4 rounded-full bg-red-600"></span>
                <span class="font-bold text-slate-700">ç©å®¶ (çº¢)</span>
            </div>
            <div id="status" class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded">
                è½®åˆ°ç©å®¶èµ°æ£‹
            </div>
            <div class="flex items-center gap-2">
                <span class="font-bold text-slate-500">ç”µè„‘ (è“)</span>
                <span class="w-4 h-4 rounded-full bg-blue-600"></span>
            </div>
        </div>

        <!-- æ£‹ç›˜ -->
        <div id="board" class="board-grid rounded shadow-2xl">
            <!-- JS ç”Ÿæˆæ ¼å­ -->
        </div>

        <!-- åº•éƒ¨æ§åˆ¶ -->
        <div class="flex gap-4 w-full">
            <button onclick="initGame()" class="flex-1 bg-white hover:bg-slate-50 text-slate-700 font-bold py-3 rounded-xl shadow transition">
                â™»ï¸ é‡æ–°å¼€å§‹
            </button>
            <div class="bg-white p-3 rounded-xl shadow text-xs text-slate-500 flex-1">
                è§„åˆ™æç¤ºï¼š<br>
                ğŸ˜>ğŸ¦>ğŸ¯>ğŸ†>ğŸº>ğŸ•>ğŸˆ>ğŸ€<br>
                âš ï¸ å”¯ä¸€ç‰¹ä¾‹ï¼šğŸ€ å¯ä»¥åƒ ğŸ˜
            </div>
        </div>

    </div>

    <script>
        // --- æ¸¸æˆé…ç½® ---
        const ROW = 9;
        const COL = 7;
        const RED = 1;  // ç©å®¶
        const BLUE = -1; // ç”µè„‘
        
        // æ£‹å­å®šä¹‰ (ç­‰çº§ 8-1)
        const PIECES = {
            8: { name: 'ğŸ˜', rank: 8 },
            7: { name: 'ğŸ¦', rank: 7 },
            6: { name: 'ğŸ¯', rank: 6 },
            5: { name: 'ğŸ†', rank: 5 },
            4: { name: 'ğŸº', rank: 4 },
            3: { name: 'ğŸ•', rank: 3 },
            2: { name: 'ğŸˆ', rank: 2 },
            1: { name: 'ğŸ€', rank: 1 }
        };

        // åœ°å½¢å®šä¹‰
        // 0:ç©ºåœ°, 1:æ²³, 2:çº¢é™·é˜±, 3:è“é™·é˜±, 4:çº¢ç©´, 5:è“ç©´
        const MAP = [
            [0, 2, 5, 2, 0, 0, 0], // 0 (è“æ–¹è€å®¶)
            [0, 0, 2, 0, 0, 0
